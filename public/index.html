<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ú–∞–≥–∞–∑–∏–Ω</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { margin:0; padding:1rem; font-family:sans-serif; background:#111; color:#fafafa; }
    h1   { font-size:1.2rem; }
    .card{ background:#222; border-radius:8px; padding:1rem; margin-bottom:1rem; }
    .btn { display:block; width:100%; padding:.7rem; margin-top:1rem;
          background:#4caf50; border:none; border-radius:6px; color:#fff; font-size:1rem; }
    img  { width:100%; border-radius:4px; margin-bottom:8px; }
  </style>
</head>
<body>
  <h1>üíé –¢–µ—Å—Ç–æ–≤–∞—è –≤–∏—Ç—Ä–∏–Ω–∞</h1>
  <div id="list"></div>

  <script>
    const TOKEN = new URLSearchParams(location.search).get('tgWebAppInitData') || ''; // –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã —Å —Å–µ—Ä–≤–µ—Ä–∞
    fetch('/api/products')
      .then(r => r.json())
      .then(products => {
        const list = document.getElementById('list');
        products.forEach(p => {
          const card = document.createElement('div');
          card.className = 'card';

          let imgHtml = '';
          if (p.photo_file_id) {
            // –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Ñ–∞–π–ª–∞
            imgHtml = `<img src="/api/file/${p.photo_file_id}" />`;
          }

          card.innerHTML = `
            ${imgHtml}
            <b>${p.name}</b><br>
            –¶–µ–Ω–∞: <b>${p.price_rub} ‚ÇΩ</b><br>
            –†–∞–∑–º–µ—Ä: <b>${p.size||'‚Äî'}</b>
            <button class="btn" onclick="buy('${p.article}')">–ö—É–ø–∏—Ç—å</button>
          `;
          list.appendChild(card);
        });
      });

    function buy(article) {
      Telegram.WebApp.sendData(JSON.stringify({ article }));
    }

    Telegram.WebApp.ready();
    Telegram.WebApp.expand();
  </script>
</body>
</html>
