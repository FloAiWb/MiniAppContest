<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ú–∞–≥–∞–∑–∏–Ω</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 1rem;
      background: #111;
      color: #fafafa;
    }
    h1 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }
    .card {
      background: #222;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .btn {
      display: block;
      width: 100%;
      padding: .7rem 1rem;
      margin-top: 1rem;
      background: #4caf50;
      border: none;
      border-radius: 6px;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
    }
    .empty {
      text-align: center;
      color: #888;
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <h1>üíé –¢–µ—Å—Ç–æ–≤–∞—è –≤–∏—Ç—Ä–∏–Ω–∞</h1>
  <div id="list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

  <script>
    // –ñ–¥—ë–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Telegram WebApp
    Telegram.WebApp.ready();
    Telegram.WebApp.expand();

    // –≠–ª–µ–º–µ–Ω—Ç-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    const list = document.getElementById('list');

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø–æ–∫—É–ø–∫–∏
    function buy(article) {
      // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
      Telegram.WebApp.sendData(JSON.stringify({ article }));
      // –º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ:
      Telegram.WebApp.showAlert('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!\n–ê—Ä—Ç–∏–∫—É–ª: ' + article);
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã —Å –≤–∞—à–µ–≥–æ –±—ç–∫–∞
    fetch('/api/products')
      .then(res => res.json())
      .then(products => {
        list.innerHTML = '';  // —É–±–∏—Ä–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–ó–∞–≥—Ä—É–∑–∫–∞..."
        if (products.length === 0) {
          list.innerHTML = '<div class="empty">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
          return;
        }

        products.forEach(p => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <b>${p.name}</b><br>
            –¶–µ–Ω–∞: <b>${p.price_rub ?? p.price} ‚ÇΩ</b><br>
            –†–∞–∑–º–µ—Ä: <b>${p.size || '‚Äî'}</b>
            <button class="btn" onclick="buy('${p.article}')">–ö—É–ø–∏—Ç—å</button>
          `;
          list.appendChild(card);
        });
      })
      .catch(err => {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–æ–≤:', err);
        list.innerHTML = '<div class="empty">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</div>';
      });
  </script>
</body>
</html>
